shadow$provide.module$node_modules$$firebase$storage$dist$index_cjs=function(global,process,require,module,exports,shadow$shims){function unknown(){return new FirebaseStorageError(Code.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function canceled(){return new FirebaseStorageError(Code.CANCELED,"User canceled the upload/download.")}function cannotSliceBlob(){return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}
function invalidArgument(index,fnName,message){return new FirebaseStorageError(Code.INVALID_ARGUMENT,"Invalid argument in `"+fnName+"` at index "+index+": "+message)}function appDeleted(){return new FirebaseStorageError(Code.APP_DELETED,"The Firebase app was deleted.")}function invalidFormat(format,message){return new FirebaseStorageError(Code.INVALID_FORMAT,"String does not match format '"+format+"': "+message)}function internalError(message){throw new FirebaseStorageError(Code.INTERNAL_ERROR,"Internal error: "+
message);}function formatValidator(stringFormat){switch(stringFormat){case StringFormat.RAW:case StringFormat.BASE64:case StringFormat.BASE64URL:case StringFormat.DATA_URL:break;default:throw"Expected one of the event types: ["+StringFormat.RAW+", "+StringFormat.BASE64+", "+StringFormat.BASE64URL+", "+StringFormat.DATA_URL+"].";}}function dataFromString(format,string){switch(format){case StringFormat.RAW:return new StringData(utf8Bytes_(string));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(format,
string));case StringFormat.DATA_URL:format=new DataURLParts(string);if(format.base64)var JSCompiler_inline_result=base64Bytes_(StringFormat.BASE64,format.rest);else{try{JSCompiler_inline_result=decodeURIComponent(format.rest)}catch(e){throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.");}JSCompiler_inline_result=utf8Bytes_(JSCompiler_inline_result)}string=(new DataURLParts(string)).contentType;return new StringData(JSCompiler_inline_result,string)}throw unknown();}function utf8Bytes_(string){for(var b=
[],i=0;i<string.length;i++){var c=string.charCodeAt(i);if(127>=c)b.push(c);else if(2047>=c)b.push(192|c>>6,128|c&63);else if(55296==(c&64512))if(i<string.length-1&&56320==(string.charCodeAt(i+1)&64512)){var lo=string.charCodeAt(++i);c=65536|(c&1023)<<10|lo&1023;b.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63)}else b.push(239,191,189);else 56320==(c&64512)?b.push(239,191,189):b.push(224|c>>12,128|c>>6&63,128|c&63)}return new Uint8Array(b)}function base64Bytes_(format,string){switch(format){case StringFormat.BASE64:var hasMinus=
-1!==string.indexOf("-"),hasUnder=-1!==string.indexOf("_");if(hasMinus||hasUnder)throw invalidFormat(format,"Invalid character '"+(hasMinus?"-":"_")+"' found: is it base64url encoded?");break;case StringFormat.BASE64URL:hasMinus=-1!==string.indexOf("+");hasUnder=-1!==string.indexOf("/");if(hasMinus||hasUnder)throw invalidFormat(format,"Invalid character '"+(hasMinus?"+":"/")+"' found: is it base64 encoded?");string=string.replace(/-/g,"+").replace(/_/g,"/")}try{var bytes=atob(string)}catch(e){throw invalidFormat(format,
"Invalid character found");}format=new Uint8Array(bytes.length);for(string=0;string<bytes.length;string++)format[string]=bytes.charCodeAt(string);return format}function taskStateFromInternalTaskState(state){switch(state){case InternalTaskState.RUNNING:case InternalTaskState.PAUSING:case InternalTaskState.CANCELING:return TaskState.RUNNING;case InternalTaskState.PAUSED:return TaskState.PAUSED;case InternalTaskState.SUCCESS:return TaskState.SUCCESS;case InternalTaskState.CANCELED:return TaskState.CANCELED;
case InternalTaskState.ERROR:return TaskState.ERROR;default:return TaskState.ERROR}}function forEach(obj,f){for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&f(key,obj[key])}function clone(obj){if(null==obj)return{};var c={};forEach(obj,function(key,val){c[key]=val});return c}function isJustDef(p){return void 0!==p}function isObject(p){return"object"===typeof p}function isString(p){return"string"===typeof p||p instanceof String}function isNativeBlob(p){return isNativeBlobDefined()&&
p instanceof Blob}function isNativeBlobDefined(){return"undefined"!==typeof Blob}function jsonObjectOrNull(s){try{var obj=JSON.parse(s)}catch(e){return null}s=obj;return isObject(s)&&!Array.isArray(s)?obj:null}function child(path,childPath){childPath=childPath.split("/").filter(function(component){return 0<component.length}).join("/");return 0===path.length?childPath:path+"/"+childPath}function lastComponent(path){var index=path.lastIndexOf("/",path.length-2);return-1===index?path:path.slice(index+
1)}function makeNormalUrl(urlPart){return"https://firebasestorage.googleapis.com/v0"+urlPart}function makeQueryString(params){var encode=encodeURIComponent,queryPart="?";forEach(params,function(key,val){key=encode(key)+"\x3d"+encode(val);queryPart=queryPart+key+"\x26"});return queryPart=queryPart.slice(0,-1)}function noXform_(metadata,value){return value}function getMappings(){if(mappings_)return mappings_;var mappings=[];mappings.push(new Mapping("bucket"));mappings.push(new Mapping("generation"));
mappings.push(new Mapping("metageneration"));mappings.push(new Mapping("name","fullPath",!0));var nameMapping=new Mapping("name");nameMapping.xform=function(metadata,fullPath){metadata=!isString(fullPath)||2>fullPath.length?fullPath:lastComponent(fullPath);return metadata};mappings.push(nameMapping);nameMapping=new Mapping("size");nameMapping.xform=function(metadata,size){return null!=size?+size:size};mappings.push(nameMapping);mappings.push(new Mapping("timeCreated"));mappings.push(new Mapping("updated"));
mappings.push(new Mapping("md5Hash",null,!0));mappings.push(new Mapping("cacheControl",null,!0));mappings.push(new Mapping("contentDisposition",null,!0));mappings.push(new Mapping("contentEncoding",null,!0));mappings.push(new Mapping("contentLanguage",null,!0));mappings.push(new Mapping("contentType",null,!0));mappings.push(new Mapping("metadata","customMetadata",!0));return mappings_=mappings}function addRef(metadata,authWrapper){Object.defineProperty(metadata,"ref",{get:function(){var loc=new Location$jscomp$0(metadata.bucket,
metadata.fullPath);return authWrapper.makeStorageReference(loc)}})}function fromResourceString(authWrapper,resourceString,mappings){resourceString=jsonObjectOrNull(resourceString);if(null===resourceString)return null;for(var metadata={type:"file"},len=mappings.length,i=0;i<len;i++){var mapping=mappings[i];metadata[mapping.local]=mapping.xform(metadata,resourceString[mapping.server])}addRef(metadata,authWrapper);return metadata}function downloadUrlFromResourceString(metadata,resourceString){resourceString=
jsonObjectOrNull(resourceString);if(null===resourceString||!isString(resourceString.downloadTokens))return null;resourceString=resourceString.downloadTokens;if(0===resourceString.length)return null;var encode=encodeURIComponent;return resourceString.split(",").map(function(token){var path=metadata.fullPath;path="https://firebasestorage.googleapis.com/v0"+("/b/"+encode(metadata.bucket)+"/o/"+encode(path));token=makeQueryString({alt:"media",token:token});return path+token})[0]}function toResourceString(metadata,
mappings){for(var resource={},len=mappings.length,i=0;i<len;i++){var mapping=mappings[i];mapping.writable&&(resource[mapping.server]=metadata[mapping.local])}return JSON.stringify(resource)}function metadataValidator(p){if(!p||!isObject(p))throw"Expected Metadata object.";for(var key in p){var val=p[key];if("customMetadata"===key){if(!isObject(val))throw"Expected object for 'customMetadata' mapping.";}else if(isObject(val)&&null!==val)throw"Mapping for '"+key+"' cannot be an object.";}}function validate(name,
specs,passed){for(var minArgs=specs.length,maxArgs=specs.length,i=0;i<specs.length;i++)if(specs[i].optional){minArgs=i;break}if(!(minArgs<=passed.length&&passed.length<=maxArgs))throw minArgs===maxArgs?(specs=minArgs,minArgs=1===minArgs?"argument":"arguments"):(specs="between "+minArgs+" and "+maxArgs,minArgs="arguments"),new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+name+"`: Expected "+specs+" "+minArgs+", received "+passed.length+".");for(i=0;i<passed.length;i++)try{specs[i].validator(passed[i])}catch(e){if(e instanceof
Error)throw invalidArgument(i,name,e.message);throw invalidArgument(i,name,e);}}function and_(v1,v2){return function(p){v1(p);v2(p)}}function stringSpec(opt_validator,opt_optional){function stringValidator(p){if(!isString(p))throw"Expected string.";}opt_validator=opt_validator?and_(stringValidator,opt_validator):stringValidator;return new ArgSpec(opt_validator,opt_optional)}function uploadDataSpec(){return new ArgSpec(function(p){if(!(p instanceof Uint8Array||p instanceof ArrayBuffer||isNativeBlobDefined()&&
p instanceof Blob))throw"Expected Blob or File.";})}function nonNegativeNumberSpec(){return new ArgSpec(function(p){if(!(("number"===typeof p||p instanceof Number)&&0<=p))throw"Expected a number 0 or greater.";})}function looseObjectSpec(opt_validator,opt_optional){return new ArgSpec(function(p){if(!(null===p||null!=p&&p instanceof Object))throw"Expected an Object.";void 0!==opt_validator&&null!==opt_validator&&opt_validator(p)},opt_optional)}function nullFunctionSpec(opt_optional){return new ArgSpec(function(p){if(null!==
p&&"function"!==typeof p)throw"Expected a Function.";},opt_optional)}function getBlob(){for(var var_args=[],_i=0;_i<arguments.length;_i++)var_args[_i]=arguments[_i];_i="undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==_i){_i=new _i;for(var i=0;i<var_args.length;i++)_i.append(var_args[i]);return _i.getBlob()}if(isNativeBlobDefined())return new Blob(var_args);throw Error("This browser doesn't seem to support creating Blobs");}function handlerCheck(cndn){if(!cndn)throw unknown();
}function metadataHandler(authWrapper,mappings){return function(xhr,text){xhr=fromResourceString(authWrapper,text,mappings);handlerCheck(null!==xhr);return xhr}}function downloadUrlHandler(authWrapper,mappings){return function(xhr,text){xhr=fromResourceString(authWrapper,text,mappings);handlerCheck(null!==xhr);return downloadUrlFromResourceString(xhr,text)}}function sharedErrorHandler(location){return function(xhr,err){xhr=401===xhr.getStatus()?new FirebaseStorageError(Code.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):
402===xhr.getStatus()?new FirebaseStorageError(Code.QUOTA_EXCEEDED,"Quota for bucket '"+location.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===xhr.getStatus()?new FirebaseStorageError(Code.UNAUTHORIZED,"User does not have permission to access '"+location.path+"'."):err;xhr.setServerResponseProp(err.serverResponseProp());return xhr}}function objectErrorHandler(location){var shared=sharedErrorHandler(location);return function(xhr,err){var newErr=shared(xhr,err);
404===xhr.getStatus()&&(newErr=new FirebaseStorageError(Code.OBJECT_NOT_FOUND,"Object '"+location.path+"' does not exist."));newErr.setServerResponseProp(err.serverResponseProp());return newErr}}function getMetadata(authWrapper,location,mappings){var urlPart=location.fullServerUrl();urlPart=makeNormalUrl(urlPart);var timeout=authWrapper.maxOperationRetryTime();authWrapper=new RequestInfo(urlPart,"GET",metadataHandler(authWrapper,mappings),timeout);authWrapper.errorHandler=objectErrorHandler(location);
return authWrapper}function getDownloadUrl(authWrapper,location,mappings){var urlPart=location.fullServerUrl();urlPart=makeNormalUrl(urlPart);var timeout=authWrapper.maxOperationRetryTime();authWrapper=new RequestInfo(urlPart,"GET",downloadUrlHandler(authWrapper,mappings),timeout);authWrapper.errorHandler=objectErrorHandler(location);return authWrapper}function deleteObject(authWrapper,location){var urlPart=location.fullServerUrl();urlPart=makeNormalUrl(urlPart);authWrapper=authWrapper.maxOperationRetryTime();
authWrapper=new RequestInfo(urlPart,"DELETE",function(xhr,text){},authWrapper);authWrapper.successCodes=[200,204];authWrapper.errorHandler=objectErrorHandler(location);return authWrapper}function metadataForUpload_(location,blob,opt_metadata){opt_metadata=clone(opt_metadata);opt_metadata.fullPath=location.path;opt_metadata.size=blob.size();opt_metadata.contentType||(opt_metadata.contentType=blob&&blob.type()||"application/octet-stream");return opt_metadata}function multipartUpload(authWrapper,location,
mappings,blob,opt_metadata){var urlPart=location.bucketOnlyServerUrl(),headers={"X-Goog-Upload-Protocol":"multipart"};var boundary="";for(var i=0;2>i;i++)boundary+=Math.random().toString().slice(2);headers["Content-Type"]="multipart/related; boundary\x3d"+boundary;opt_metadata=metadataForUpload_(location,blob,opt_metadata);i=toResourceString(opt_metadata,mappings);blob=FbsBlob.getBlob("--"+boundary+"\r\nContent-Type: application/json; charset\x3dutf-8\r\n\r\n"+i+"\r\n--"+boundary+"\r\nContent-Type: "+
opt_metadata.contentType+"\r\n\r\n",blob,"\r\n--"+boundary+"--");if(null===blob)throw cannotSliceBlob();opt_metadata={name:opt_metadata.fullPath};urlPart="https://firebasestorage.googleapis.com/v0"+urlPart;boundary=authWrapper.maxUploadRetryTime();authWrapper=new RequestInfo(urlPart,"POST",metadataHandler(authWrapper,mappings),boundary);authWrapper.urlParams=opt_metadata;authWrapper.headers=headers;authWrapper.body=blob.uploadData();authWrapper.errorHandler=sharedErrorHandler(location);return authWrapper}
function checkResumeHeader_(xhr,opt_allowed){try{var status=xhr.getResponseHeader("X-Goog-Upload-Status")}catch(e){handlerCheck(!1)}handlerCheck(-1!==(opt_allowed||["active"]).indexOf(status));return status}function createResumableUpload(authWrapper,location,mappings,blob,opt_metadata){var urlPart=location.bucketOnlyServerUrl(),metadata=metadataForUpload_(location,blob,opt_metadata);opt_metadata={name:metadata.fullPath};urlPart="https://firebasestorage.googleapis.com/v0"+urlPart;blob={"X-Goog-Upload-Protocol":"resumable",
"X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":blob.size(),"X-Goog-Upload-Header-Content-Type":metadata.contentType,"Content-Type":"application/json; charset\x3dutf-8"};mappings=toResourceString(metadata,mappings);authWrapper=authWrapper.maxUploadRetryTime();authWrapper=new RequestInfo(urlPart,"POST",function(xhr,text){checkResumeHeader_(xhr);try{var url=xhr.getResponseHeader("X-Goog-Upload-URL")}catch(e){handlerCheck(!1)}handlerCheck(isString(url));return url},authWrapper);
authWrapper.urlParams=opt_metadata;authWrapper.headers=blob;authWrapper.body=mappings;authWrapper.errorHandler=sharedErrorHandler(location);return authWrapper}function getResumableUploadStatus(authWrapper,location,url,blob){authWrapper=authWrapper.maxUploadRetryTime();url=new RequestInfo(url,"POST",function(xhr,text){text=checkResumeHeader_(xhr,["active","final"]);try{var sizeString=xhr.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){handlerCheck(!1)}xhr=parseInt(sizeString,10);handlerCheck(!isNaN(xhr));
return new ResumableUploadStatus(xhr,blob.size(),"final"===text)},authWrapper);url.headers={"X-Goog-Upload-Command":"query"};url.errorHandler=sharedErrorHandler(location);return url}function continueResumableUpload(location,authWrapper,url,blob,chunkSize,mappings,opt_status,opt_progressCallback){var status=new ResumableUploadStatus(0,0);opt_status?(status.current=opt_status.current,status.total=opt_status.total):(status.current=0,status.total=blob.size());if(blob.size()!==status.total)throw new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE,
"Server recorded incorrect upload file size, please retry the upload.");var bytesToUpload=opt_status=status.total-status.current;0<chunkSize&&(bytesToUpload=Math.min(bytesToUpload,chunkSize));var startByte=status.current;chunkSize={"X-Goog-Upload-Command":bytesToUpload===opt_status?"upload, finalize":"upload","X-Goog-Upload-Offset":status.current};opt_status=blob.slice(startByte,startByte+bytesToUpload);if(null===opt_status)throw cannotSliceBlob();startByte=authWrapper.maxUploadRetryTime();url=new RequestInfo(url,
"POST",function(xhr,text){var uploadStatus=checkResumeHeader_(xhr,["active","final"]),newCurrent=status.current+bytesToUpload,size=blob.size();xhr="final"===uploadStatus?metadataHandler(authWrapper,mappings)(xhr,text):null;return new ResumableUploadStatus(newCurrent,size,"final"===uploadStatus,xhr)},startByte);url.headers=chunkSize;url.body=opt_status.uploadData();url.progressCallback=opt_progressCallback||null;url.errorHandler=sharedErrorHandler(location);return url}function async(f){return function(){for(var argsToForward=
[],_i=0;_i<arguments.length;_i++)argsToForward[_i]=arguments[_i];Promise.resolve(!0).then(function(){f.apply(null,argsToForward)})}}function start(f,callback,timeout){function triggerCallback(){triggeredCallback||(triggeredCallback=!0,callback.apply(null,arguments))}function callWithDelay(millis){timeoutId=setTimeout(function(){timeoutId=null;f(handler,2===cancelState)},millis)}function handler(success){for(var _i=1;_i<arguments.length;_i++);triggeredCallback||(success?triggerCallback.apply(null,
arguments):2===cancelState||hitTimeout?triggerCallback.apply(null,arguments):(64>waitSeconds&&(waitSeconds*=2),1===cancelState?(cancelState=2,_i=0):_i=1E3*(waitSeconds+Math.random()),callWithDelay(_i)))}function stop(wasTimeout){stopped||(stopped=!0,triggeredCallback||(null!==timeoutId?(wasTimeout||(cancelState=2),clearTimeout(timeoutId),callWithDelay(0)):wasTimeout||(cancelState=1)))}var waitSeconds=1,timeoutId=null,hitTimeout=!1,cancelState=0,triggeredCallback=!1,stopped=!1;callWithDelay(0);setTimeout(function(){hitTimeout=
!0;stop(!0)},timeout);return stop}function makeRequest(requestInfo,authToken,pool){var queryPart=makeQueryString(requestInfo.urlParams);queryPart=requestInfo.url+queryPart;var headers=clone(requestInfo.headers);null!==authToken&&0<authToken.length&&(headers.Authorization="Firebase "+authToken);headers["X-Firebase-Storage-Version"]="webjs/"+("undefined"!==typeof firebase?firebase.SDK_VERSION:"AppManager");return new NetworkRequest(queryPart,requestInfo.method,headers,requestInfo.body,requestInfo.successCodes,
requestInfo.additionalRetryCodes,requestInfo.handler,requestInfo.errorHandler,requestInfo.timeout,requestInfo.progressCallback,pool)}function factory(app,unused,opt_url){return new Service$jscomp$0(app,new XhrIoPool,opt_url)}function registerStorage(instance){instance.INTERNAL.registerService("storage",factory,{TaskState:TaskState,TaskEvent:TaskEvent,StringFormat:StringFormat,Storage:Service$jscomp$0,Reference:Reference$jscomp$0},void 0,!0)}Object.defineProperty(exports,"__esModule",{value:!0});var firebase=
function(ex){return ex&&"object"===typeof ex&&"default"in ex?ex["default"]:ex}(require("module$node_modules$$firebase$app$dist$index_cjs")),FirebaseStorageError=function(){function FirebaseStorageError(code,message){this.code_="storage/"+code;this.message_="Firebase Storage: "+message;this.serverResponse_=null;this.name_="FirebaseError"}FirebaseStorageError.prototype.codeProp=function(){return this.code};FirebaseStorageError.prototype.codeEquals=function(code){return"storage/"+code===this.codeProp()};
FirebaseStorageError.prototype.serverResponseProp=function(){return this.serverResponse_};FirebaseStorageError.prototype.setServerResponseProp=function(serverResponse){this.serverResponse_=serverResponse};Object.defineProperty(FirebaseStorageError.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,
"message",{get:function(){return this.message_},enumerable:!0,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0});return FirebaseStorageError}(),Code={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",
INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",
INTERNAL_ERROR:"internal-error"},StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},StringData=function(){return function(data,opt_contentType){this.data=data;this.contentType=opt_contentType||null}}(),DataURLParts=function(){return function(dataURL){this.base64=!1;this.contentType=null;var matches=dataURL.match(/^data:([^,]+)?,/);if(null===matches)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[\x3cmediatype\x3e][;base64],\x3cdata\x3e");matches=
matches[1]||null;if(null!=matches){var JSCompiler_inline_result=7<=matches.length?";base64"===matches.substring(matches.length-7):!1;this.contentType=(this.base64=JSCompiler_inline_result)?matches.substring(0,matches.length-7):matches}this.rest=dataURL.substring(dataURL.indexOf(",")+1)}}(),TaskEvent={STATE_CHANGED:"state_changed"},InternalTaskState={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},TaskState={RUNNING:"running",
PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"},ErrorCode;(function(ErrorCode){ErrorCode[ErrorCode.NO_ERROR=0]="NO_ERROR";ErrorCode[ErrorCode.NETWORK_ERROR=1]="NETWORK_ERROR";ErrorCode[ErrorCode.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));var NetworkXhrIo=function(){function NetworkXhrIo(){var _this=this;this.sent_=!1;this.xhr_=new XMLHttpRequest;this.errorCode_=ErrorCode.NO_ERROR;this.sendPromise_=new Promise(function(resolve,reject){_this.xhr_.addEventListener("abort",function(event){_this.errorCode_=
ErrorCode.ABORT;resolve(_this)});_this.xhr_.addEventListener("error",function(event){_this.errorCode_=ErrorCode.NETWORK_ERROR;resolve(_this)});_this.xhr_.addEventListener("load",function(event){resolve(_this)})})}NetworkXhrIo.prototype.send=function(url,method,opt_body,opt_headers){var _this=this;if(this.sent_)throw internalError("cannot .send() more than once");this.sent_=!0;this.xhr_.open(method,url,!0);null!=opt_headers&&forEach(opt_headers,function(key,val){_this.xhr_.setRequestHeader(key,val.toString())});
null!=opt_body?this.xhr_.send(opt_body):this.xhr_.send();return this.sendPromise_};NetworkXhrIo.prototype.getErrorCode=function(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_};NetworkXhrIo.prototype.getStatus=function(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}};NetworkXhrIo.prototype.getResponseText=function(){if(!this.sent_)throw internalError("cannot .getResponseText() before sending");
return this.xhr_.responseText};NetworkXhrIo.prototype.abort=function(){this.xhr_.abort()};NetworkXhrIo.prototype.getResponseHeader=function(header){return this.xhr_.getResponseHeader(header)};NetworkXhrIo.prototype.addUploadProgressListener=function(listener){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",listener)};NetworkXhrIo.prototype.removeUploadProgressListener=function(listener){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",listener)};return NetworkXhrIo}(),
XhrIoPool=function(){function XhrIoPool(){}XhrIoPool.prototype.createXhrIo=function(){return new NetworkXhrIo};return XhrIoPool}(),Location$jscomp$0=function(){function Location(bucket,path){this.bucket=bucket;this.path_=path}Object.defineProperty(Location.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0});Location.prototype.fullServerUrl=function(){var encode=encodeURIComponent;return"/b/"+encode(this.bucket)+"/o/"+encode(this.path)};Location.prototype.bucketOnlyServerUrl=
function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"};Location.makeFromBucketSpec=function(bucketString){try{var bucketLocation=Location.makeFromUrl(bucketString)}catch(e){return new Location(bucketString,"")}if(""===bucketLocation.path)return bucketLocation;throw new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+bucketString+"'.");};Location.makeFromUrl=function(url){for(var location=null,groups=[{regex:/^gs:\/\/([A-Za-z0-9.\-_]+)(\/(.*))?$/i,indices:{bucket:1,
path:3},postModify:function(loc){"/"===loc.path.charAt(loc.path.length-1)&&(loc.path_=loc.path_.slice(0,-1))}},{regex:/^https?:\/\/firebasestorage\.googleapis\.com\/v[A-Za-z0-9_]+\/b\/([A-Za-z0-9.\-_]+)\/o(\/([^?#]*).*)?$/i,indices:{bucket:1,path:3},postModify:function(loc){loc.path_=decodeURIComponent(loc.path)}}],i=0;i<groups.length;i++){var group=groups[i],captures=group.regex.exec(url);if(captures){location=captures[group.indices.bucket];(captures=captures[group.indices.path])||(captures="");
location=new Location(location,captures);group.postModify(location);break}}if(null==location)throw new FirebaseStorageError(Code.INVALID_URL,"Invalid URL '"+url+"'.");return location};return Location}(),Mapping=function(){return function(server,opt_local,opt_writable,opt_xform){this.server=server;this.local=opt_local||server;this.writable=!!opt_writable;this.xform=opt_xform||noXform_}}(),mappings_=null,ArgSpec=function(){return function(validator,opt_optional){var self=this;this.validator=function(p){self.optional&&
!isJustDef(p)||validator(p)};this.optional=!!opt_optional}}(),FbsBlob=function(){function FbsBlob(data,opt_elideCopy){var size=0,blobType="";isNativeBlob(data)?(this.data_=data,size=data.size,blobType=data.type):data instanceof ArrayBuffer?(opt_elideCopy?this.data_=new Uint8Array(data):(this.data_=new Uint8Array(data.byteLength),this.data_.set(new Uint8Array(data))),size=this.data_.length):data instanceof Uint8Array&&(opt_elideCopy?this.data_=data:(this.data_=new Uint8Array(data.length),this.data_.set(data)),
size=data.length);this.size_=size;this.type_=blobType}FbsBlob.prototype.size=function(){return this.size_};FbsBlob.prototype.type=function(){return this.type_};FbsBlob.prototype.slice=function(startByte,endByte){if(isNativeBlob(this.data_)){var blob=this.data_;startByte=blob.webkitSlice?blob.webkitSlice(startByte,endByte):blob.mozSlice?blob.mozSlice(startByte,endByte):blob.slice?blob.slice(startByte,endByte):null;return null===startByte?null:new FbsBlob(startByte)}startByte=new Uint8Array(this.data_.buffer,
startByte,endByte-startByte);return new FbsBlob(startByte,!0)};FbsBlob.getBlob=function(){for(var var_args=[],_i=0;_i<arguments.length;_i++)var_args[_i]=arguments[_i];if(isNativeBlobDefined())return var_args=var_args.map(function(val){return val instanceof FbsBlob?val.data_:val}),new FbsBlob(getBlob.apply(null,var_args));var_args=var_args.map(function(val){return isString(val)?dataFromString(StringFormat.RAW,val).data:val.data_});var finalLength_1=0;var_args.forEach(function(array){finalLength_1+=
array.byteLength});var merged_1=new Uint8Array(finalLength_1),index_1=0;var_args.forEach(function(array){for(var i=0;i<array.length;i++)merged_1[index_1++]=array[i]});return new FbsBlob(merged_1,!0)};FbsBlob.prototype.uploadData=function(){return this.data_};return FbsBlob}(),RequestInfo=function(){return function(url,method,handler,timeout){this.url=url;this.method=method;this.handler=handler;this.timeout=timeout;this.urlParams={};this.headers={};this.progressCallback=this.errorHandler=this.body=
null;this.successCodes=[200];this.additionalRetryCodes=[]}}(),ResumableUploadStatus=function(){return function(current,total,finalized,metadata){this.current=current;this.total=total;this.finalized=!!finalized;this.metadata=metadata||null}}(),Observer=function(){return function(nextOrObserver,opt_error,opt_complete){"function"===typeof nextOrObserver||null!=opt_error||null!=opt_complete?(this.next=nextOrObserver,this.error=opt_error||null,this.complete=opt_complete||null):(this.next=nextOrObserver.next||
null,this.error=nextOrObserver.error||null,this.complete=nextOrObserver.complete||null)}}(),UploadTaskSnapshot=function(){return function(bytesTransferred,totalBytes,state,metadata,task,ref){this.bytesTransferred=bytesTransferred;this.totalBytes=totalBytes;this.state=state;this.metadata=metadata;this.task=task;this.ref=ref}}(),UploadTask=function(){function UploadTask(ref,authWrapper,location,mappings,blob,metadata){void 0===metadata&&(metadata=null);var _this=this;this.transferred_=0;this.needToFetchMetadata_=
this.needToFetchStatus_=!1;this.observers_=[];this.request_=this.uploadUrl_=this.error_=null;this.chunkMultiplier_=1;this.reject_=this.resolve_=null;this.ref_=ref;this.authWrapper_=authWrapper;this.location_=location;this.blob_=blob;this.metadata_=metadata;this.mappings_=mappings;this.resumable_=this.shouldDoResumable_(this.blob_);this.state_=InternalTaskState.RUNNING;this.errorHandler_=function(error){_this.request_=null;_this.chunkMultiplier_=1;error.codeEquals(Code.CANCELED)?(_this.needToFetchStatus_=
!0,_this.completeTransitions_()):(_this.error_=error,_this.transition_(InternalTaskState.ERROR))};this.metadataErrorHandler_=function(error){_this.request_=null;error.codeEquals(Code.CANCELED)?_this.completeTransitions_():(_this.error_=error,_this.transition_(InternalTaskState.ERROR))};this.promise_=new Promise(function(resolve,reject){_this.resolve_=resolve;_this.reject_=reject;_this.start_()});this.promise_.then(null,function(){})}UploadTask.prototype.makeProgressCallback_=function(){var _this=
this,sizeBefore=this.transferred_;return function(loaded,total){_this.updateProgress_(sizeBefore+loaded)}};UploadTask.prototype.shouldDoResumable_=function(blob){return 262144<blob.size()};UploadTask.prototype.start_=function(){if(this.state_===InternalTaskState.RUNNING&&null===this.request_)if(this.resumable_)null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_();else this.oneShotUpload_()};
UploadTask.prototype.resolveToken_=function(callback){var _this=this;this.authWrapper_.getAuthToken().then(function(authToken){switch(_this.state_){case InternalTaskState.RUNNING:callback(authToken);break;case InternalTaskState.CANCELING:_this.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.PAUSING:_this.transition_(InternalTaskState.PAUSED)}})};UploadTask.prototype.createResumable_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=createResumableUpload(_this.authWrapper_,
_this.location_,_this.mappings_,_this.blob_,_this.metadata_);authToken=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(url){_this.request_=null;_this.uploadUrl_=url;_this.needToFetchStatus_=!1;_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.fetchStatus_=function(){var _this=this,url=this.uploadUrl_;this.resolveToken_(function(authToken){var requestInfo=getResumableUploadStatus(_this.authWrapper_,_this.location_,
url,_this.blob_);authToken=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(status){_this.request_=null;_this.updateProgress_(status.current);_this.needToFetchStatus_=!1;status.finalized&&(_this.needToFetchMetadata_=!0);_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.continueUpload_=function(){var _this=this,chunkSize=262144*this.chunkMultiplier_,status=new ResumableUploadStatus(this.transferred_,this.blob_.size()),
url=this.uploadUrl_;this.resolveToken_(function(authToken){try{var requestInfo=continueResumableUpload(_this.location_,_this.authWrapper_,url,_this.blob_,chunkSize,_this.mappings_,status,_this.makeProgressCallback_())}catch(e){_this.error_=e;_this.transition_(InternalTaskState.ERROR);return}authToken=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(newStatus){_this.increaseMultiplier_();_this.request_=null;_this.updateProgress_(newStatus.current);
newStatus.finalized?(_this.metadata_=newStatus.metadata,_this.transition_(InternalTaskState.SUCCESS)):_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.increaseMultiplier_=function(){33554432>262144*this.chunkMultiplier_&&(this.chunkMultiplier_*=2)};UploadTask.prototype.fetchMetadata_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=getMetadata(_this.authWrapper_,_this.location_,_this.mappings_);authToken=_this.authWrapper_.makeRequest(requestInfo,
authToken);_this.request_=authToken;authToken.getPromise().then(function(metadata){_this.request_=null;_this.metadata_=metadata;_this.transition_(InternalTaskState.SUCCESS)},_this.metadataErrorHandler_)})};UploadTask.prototype.oneShotUpload_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=multipartUpload(_this.authWrapper_,_this.location_,_this.mappings_,_this.blob_,_this.metadata_);authToken=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=authToken;
authToken.getPromise().then(function(metadata){_this.request_=null;_this.metadata_=metadata;_this.updateProgress_(_this.blob_.size());_this.transition_(InternalTaskState.SUCCESS)},_this.errorHandler_)})};UploadTask.prototype.updateProgress_=function(transferred){var old=this.transferred_;this.transferred_=transferred;this.transferred_!==old&&this.notifyObservers_()};UploadTask.prototype.transition_=function(state){if(this.state_!==state)switch(state){case InternalTaskState.CANCELING:this.state_=state;
null!==this.request_&&this.request_.cancel();break;case InternalTaskState.PAUSING:this.state_=state;null!==this.request_&&this.request_.cancel();break;case InternalTaskState.RUNNING:var wasPaused=this.state_===InternalTaskState.PAUSED;this.state_=state;wasPaused&&(this.notifyObservers_(),this.start_());break;case InternalTaskState.PAUSED:this.state_=state;this.notifyObservers_();break;case InternalTaskState.CANCELED:this.error_=canceled();this.state_=state;this.notifyObservers_();break;case InternalTaskState.ERROR:this.state_=
state;this.notifyObservers_();break;case InternalTaskState.SUCCESS:this.state_=state,this.notifyObservers_()}};UploadTask.prototype.completeTransitions_=function(){switch(this.state_){case InternalTaskState.PAUSING:this.transition_(InternalTaskState.PAUSED);break;case InternalTaskState.CANCELING:this.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.RUNNING:this.start_()}};Object.defineProperty(UploadTask.prototype,"snapshot",{get:function(){var externalState=taskStateFromInternalTaskState(this.state_);
return new UploadTaskSnapshot(this.transferred_,this.blob_.size(),externalState,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0});UploadTask.prototype.on=function(type,nextOrObserver$jscomp$0,error$jscomp$0,completed){function nextOrObserverValidator(p){try{nextValidator(p);return}catch(e){}try{if(observerValidator(p),!(isJustDef(p.next)||isJustDef(p.error)||isJustDef(p.complete)))throw"";}catch(e$14){throw"Expected a function or an Object with one of `next`, `error`, `complete` properties.";
}}function makeBinder(specs){return function(nextOrObserver,error,opt_complete){null!==specs&&validate("on",specs,arguments);var observer=new Observer(nextOrObserver,error,completed);self.addObserver_(observer);return function(){self.removeObserver_(observer)}}}void 0===nextOrObserver$jscomp$0&&(nextOrObserver$jscomp$0=void 0);void 0===error$jscomp$0&&(error$jscomp$0=void 0);void 0===completed&&(completed=void 0);var nextValidator=nullFunctionSpec(!0).validator,observerValidator=looseObjectSpec(null,
!0).validator,specs$jscomp$0=[stringSpec(function(_p){if(type!==TaskEvent.STATE_CHANGED)throw"Expected one of the event types: ["+TaskEvent.STATE_CHANGED+"].";}),looseObjectSpec(nextOrObserverValidator,!0),nullFunctionSpec(!0),nullFunctionSpec(!0)];validate("on",specs$jscomp$0,arguments);var self=this;specs$jscomp$0=[looseObjectSpec(function(p){if(null===p)throw"Expected a function or an Object with one of `next`, `error`, `complete` properties.";nextOrObserverValidator(p)}),nullFunctionSpec(!0),
nullFunctionSpec(!0)];return isJustDef(nextOrObserver$jscomp$0)||isJustDef(error$jscomp$0)||isJustDef(completed)?makeBinder(null)(nextOrObserver$jscomp$0,error$jscomp$0,completed):makeBinder(specs$jscomp$0)};UploadTask.prototype.then=function(onFulfilled,onRejected){return this.promise_.then(onFulfilled,onRejected)};UploadTask.prototype.catch=function(onRejected){return this.then(null,onRejected)};UploadTask.prototype.addObserver_=function(observer){this.observers_.push(observer);this.notifyObserver_(observer)};
UploadTask.prototype.removeObserver_=function(observer){var array=this.observers_;observer=array.indexOf(observer);-1!==observer&&array.splice(observer,1)};UploadTask.prototype.notifyObservers_=function(){var _this=this;this.finishPromise_();Array.prototype.slice.call(this.observers_).forEach(function(observer){_this.notifyObserver_(observer)})};UploadTask.prototype.finishPromise_=function(){if(null!==this.resolve_){var triggered=!0;switch(taskStateFromInternalTaskState(this.state_)){case TaskState.SUCCESS:async(this.resolve_.bind(null,
this.snapshot))();break;case TaskState.CANCELED:case TaskState.ERROR:async(this.reject_.bind(null,this.error_))();break;default:triggered=!1}triggered&&(this.reject_=this.resolve_=null)}};UploadTask.prototype.notifyObserver_=function(observer){switch(taskStateFromInternalTaskState(this.state_)){case TaskState.RUNNING:case TaskState.PAUSED:null!==observer.next&&async(observer.next.bind(observer,this.snapshot))();break;case TaskState.SUCCESS:null!==observer.complete&&async(observer.complete.bind(observer))();
break;case TaskState.CANCELED:case TaskState.ERROR:null!==observer.error&&async(observer.error.bind(observer,this.error_))();break;default:null!==observer.error&&async(observer.error.bind(observer,this.error_))()}};UploadTask.prototype.resume=function(){validate("resume",[],arguments);var valid=this.state_===InternalTaskState.PAUSED||this.state_===InternalTaskState.PAUSING;valid&&this.transition_(InternalTaskState.RUNNING);return valid};UploadTask.prototype.pause=function(){validate("pause",[],arguments);
var valid=this.state_===InternalTaskState.RUNNING;valid&&this.transition_(InternalTaskState.PAUSING);return valid};UploadTask.prototype.cancel=function(){validate("cancel",[],arguments);var valid=this.state_===InternalTaskState.RUNNING||this.state_===InternalTaskState.PAUSING;valid&&this.transition_(InternalTaskState.CANCELING);return valid};return UploadTask}(),Reference$jscomp$0=function(){function Reference(authWrapper,location){this.authWrapper=authWrapper;this.location=location instanceof Location$jscomp$0?
location:Location$jscomp$0.makeFromUrl(location)}Reference.prototype.toString=function(){validate("toString",[],arguments);return"gs://"+this.location.bucket+"/"+this.location.path};Reference.prototype.newRef=function(authWrapper,location){return new Reference(authWrapper,location)};Reference.prototype.mappings=function(){return getMappings()};Reference.prototype.child=function(childPath){validate("child",[stringSpec()],arguments);var newPath=child(this.location.path,childPath);newPath=new Location$jscomp$0(this.location.bucket,
newPath);return this.newRef(this.authWrapper,newPath)};Object.defineProperty(Reference.prototype,"parent",{get:function(){var newPath=this.location.path;if(0==newPath.length)newPath=null;else{var index=newPath.lastIndexOf("/");newPath=-1===index?"":newPath.slice(0,index)}if(null===newPath)return null;newPath=new Location$jscomp$0(this.location.bucket,newPath);return this.newRef(this.authWrapper,newPath)},enumerable:!0,configurable:!0});Object.defineProperty(Reference.prototype,"root",{get:function(){var location=
new Location$jscomp$0(this.location.bucket,"");return this.newRef(this.authWrapper,location)},enumerable:!0,configurable:!0});Object.defineProperty(Reference.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0});Object.defineProperty(Reference.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0});Object.defineProperty(Reference.prototype,"name",{get:function(){return lastComponent(this.location.path)},enumerable:!0,
configurable:!0});Object.defineProperty(Reference.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0});Reference.prototype.put=function(data,metadata){void 0===metadata&&(metadata=null);validate("put",[uploadDataSpec(),new ArgSpec(metadataValidator,!0)],arguments);this.throwIfRoot_("put");return new UploadTask(this,this.authWrapper,this.location,this.mappings(),new FbsBlob(data),metadata)};Reference.prototype.putString=function(string,format,opt_metadata){void 0===
format&&(format=StringFormat.RAW);validate("putString",[stringSpec(),stringSpec(formatValidator,!0),new ArgSpec(metadataValidator,!0)],arguments);this.throwIfRoot_("putString");var data=dataFromString(format,string),metadata=clone(opt_metadata);null==metadata.contentType&&null!=data.contentType&&(metadata.contentType=data.contentType);return new UploadTask(this,this.authWrapper,this.location,this.mappings(),new FbsBlob(data.data,!0),metadata)};Reference.prototype.delete=function(){validate("delete",
[],arguments);this.throwIfRoot_("delete");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=deleteObject(self.authWrapper,self.location);return self.authWrapper.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.getMetadata=function(){validate("getMetadata",[],arguments);this.throwIfRoot_("getMetadata");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=getMetadata(self.authWrapper,self.location,
self.mappings());return self.authWrapper.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.updateMetadata=function(metadata$jscomp$0){validate("updateMetadata",[new ArgSpec(metadataValidator,void 0)],arguments);this.throwIfRoot_("updateMetadata");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var authWrapper=self.authWrapper,location=self.location,metadata=metadata$jscomp$0,mappings=self.mappings(),urlPart=location.fullServerUrl();urlPart=makeNormalUrl(urlPart);
metadata=toResourceString(metadata,mappings);var timeout=authWrapper.maxOperationRetryTime();authWrapper=new RequestInfo(urlPart,"PATCH",metadataHandler(authWrapper,mappings),timeout);authWrapper.headers={"Content-Type":"application/json; charset\x3dutf-8"};authWrapper.body=metadata;authWrapper.errorHandler=objectErrorHandler(location);return self.authWrapper.makeRequest(authWrapper,authToken).getPromise()})};Reference.prototype.getDownloadURL=function(){validate("getDownloadURL",[],arguments);this.throwIfRoot_("getDownloadURL");
var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=getDownloadUrl(self.authWrapper,self.location,self.mappings());return self.authWrapper.makeRequest(requestInfo,authToken).getPromise().then(function(url){if(null===url)throw new FirebaseStorageError(Code.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return url})})};Reference.prototype.throwIfRoot_=function(name){if(""===this.location.path)throw new FirebaseStorageError(Code.INVALID_ROOT_OPERATION,
"The operation '"+name+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");};return Reference}(),FailRequest=function(){function FailRequest(error){this.promise_=Promise.reject(error)}FailRequest.prototype.getPromise=function(){return this.promise_};FailRequest.prototype.cancel=function(appDelete){};return FailRequest}(),RequestMap=function(){function RequestMap(){this.map_={};this.id_=-9007199254740991}RequestMap.prototype.addRequest=
function(r){function unmap(){delete self.map_[id]}var id=this.id_;this.id_++;this.map_[id]=r;var self=this;r.getPromise().then(unmap,unmap)};RequestMap.prototype.clear=function(){forEach(this.map_,function(key,val){val&&val.cancel(!0)});this.map_={}};return RequestMap}(),AuthWrapper=function(){function AuthWrapper(app,maker,requestMaker,service,pool){this.bucket_=null;this.deleted_=!1;this.app_=app;null!==this.app_&&(app=this.app_.options,null!=app&&(this.bucket_=AuthWrapper.extractBucket_(app)));
this.storageRefMaker_=maker;this.requestMaker_=requestMaker;this.pool_=pool;this.service_=service;this.maxOperationRetryTime_=12E4;this.maxUploadRetryTime_=6E4;this.requestMap_=new RequestMap}AuthWrapper.extractBucket_=function(config){config=config.storageBucket||null;return null==config?null:Location$jscomp$0.makeFromBucketSpec(config).bucket};AuthWrapper.prototype.getAuthToken=function(){return null!==this.app_&&null!=this.app_.INTERNAL&&null!=this.app_.INTERNAL.getToken?this.app_.INTERNAL.getToken().then(function(response){return null!==
response?response.accessToken:null},function(_error){return null}):Promise.resolve(null)};AuthWrapper.prototype.bucket=function(){if(this.deleted_)throw appDeleted();return this.bucket_};AuthWrapper.prototype.service=function(){return this.service_};AuthWrapper.prototype.makeStorageReference=function(loc){return this.storageRefMaker_(this,loc)};AuthWrapper.prototype.makeRequest=function(requestInfo,authToken){if(this.deleted_)return new FailRequest(appDeleted());requestInfo=this.requestMaker_(requestInfo,
authToken,this.pool_);this.requestMap_.addRequest(requestInfo);return requestInfo};AuthWrapper.prototype.deleteApp=function(){this.deleted_=!0;this.app_=null;this.requestMap_.clear()};AuthWrapper.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_};AuthWrapper.prototype.setMaxUploadRetryTime=function(time){this.maxUploadRetryTime_=time};AuthWrapper.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_};AuthWrapper.prototype.setMaxOperationRetryTime=function(time){this.maxOperationRetryTime_=
time};return AuthWrapper}(),NetworkRequest=function(){function NetworkRequest(url,method,headers,body,successCodes,additionalRetryCodes,callback,errorCallback,timeout,progressCallback,pool){this.reject_=this.resolve_=this.backoffId_=this.pendingXhr_=null;this.appDelete_=this.canceled_=!1;this.url_=url;this.method_=method;this.headers_=headers;this.body_=body;this.successCodes_=successCodes.slice();this.additionalRetryCodes_=additionalRetryCodes.slice();this.callback_=callback;this.errorCallback_=
errorCallback;this.progressCallback_=progressCallback;this.timeout_=timeout;this.pool_=pool;var self=this;this.promise_=new Promise(function(resolve,reject){self.resolve_=resolve;self.reject_=reject;self.start_()})}NetworkRequest.prototype.start_=function(){function doTheRequest(backoffCallback,canceled){function progressListener(progressEvent){var loaded=progressEvent.loaded;progressEvent=progressEvent.lengthComputable?progressEvent.total:-1;null!==self.progressCallback_&&self.progressCallback_(loaded,
progressEvent)}canceled?backoffCallback(!1,new RequestEndStatus(!1,null,!0)):(canceled=self.pool_.createXhrIo(),self.pendingXhr_=canceled,null!==self.progressCallback_&&canceled.addUploadProgressListener(progressListener),canceled.send(self.url_,self.method_,self.body_,self.headers_).then(function(xhr){null!==self.progressCallback_&&xhr.removeUploadProgressListener(progressListener);self.pendingXhr_=null;var hitServer=xhr.getErrorCode()===ErrorCode.NO_ERROR,status=xhr.getStatus();!hitServer||self.isRetryStatusCode_(status)?
(xhr=xhr.getErrorCode()===ErrorCode.ABORT,backoffCallback(!1,new RequestEndStatus(!1,null,xhr))):(hitServer=-1!==self.successCodes_.indexOf(status),backoffCallback(!0,new RequestEndStatus(hitServer,xhr)))}))}function backoffDone(requestWentThrough,status){var resolve=self.resolve_;requestWentThrough=self.reject_;var xhr=status.xhr;if(status.wasSuccessCode)try{var result=self.callback_(xhr,xhr.getResponseText());isJustDef(result)?resolve(result):resolve()}catch(e){requestWentThrough(e)}else null!==
xhr?(status=unknown(),status.setServerResponseProp(xhr.getResponseText()),self.errorCallback_?requestWentThrough(self.errorCallback_(xhr,status)):requestWentThrough(status)):(status=status.canceled?self.appDelete_?appDeleted():canceled():new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."),requestWentThrough(status))}var self=this;this.canceled_?backoffDone(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(doTheRequest,backoffDone,
this.timeout_)};NetworkRequest.prototype.getPromise=function(){return this.promise_};NetworkRequest.prototype.cancel=function(appDelete){this.canceled_=!0;this.appDelete_=appDelete||!1;null!==this.backoffId_&&(0,this.backoffId_)(!1);null!==this.pendingXhr_&&this.pendingXhr_.abort()};NetworkRequest.prototype.isRetryStatusCode_=function(status){var isFiveHundredCode=500<=status&&600>status,isExtraRetryCode=-1!==[408,429].indexOf(status);status=-1!==this.additionalRetryCodes_.indexOf(status);return isFiveHundredCode||
isExtraRetryCode||status};return NetworkRequest}(),RequestEndStatus=function(){return function(wasSuccessCode,xhr,opt_canceled){this.wasSuccessCode=wasSuccessCode;this.xhr=xhr;this.canceled=!!opt_canceled}}(),Service$jscomp$0=function(){function Service(app,pool,url){this.bucket_=null;this.authWrapper_=new AuthWrapper(app,function(authWrapper,loc){return new Reference$jscomp$0(authWrapper,loc)},makeRequest,this,pool);this.app_=app;null!=url?this.bucket_=Location$jscomp$0.makeFromBucketSpec(url):(app=
this.authWrapper_.bucket(),null!=app&&(this.bucket_=new Location$jscomp$0(app,"")));this.internals_=new ServiceInternals(this)}Service.prototype.ref=function(path$jscomp$0){validate("ref",[stringSpec(function(path){if(/^[A-Za-z]+:\/\//.test(path))throw"Expected child path but got a URL, use refFromURL instead.";},!0)],arguments);if(null==this.bucket_)throw Error("No Storage Bucket defined in Firebase Options.");var ref=new Reference$jscomp$0(this.authWrapper_,this.bucket_);return null!=path$jscomp$0?
ref.child(path$jscomp$0):ref};Service.prototype.refFromURL=function(url){validate("refFromURL",[stringSpec(function(p){if(!/^[A-Za-z]+:\/\//.test(p))throw"Expected full URL but got a child path, use ref instead.";try{Location$jscomp$0.makeFromUrl(p)}catch(e){throw"Expected valid full URL but got an invalid one.";}},!1)],arguments);return new Reference$jscomp$0(this.authWrapper_,url)};Object.defineProperty(Service.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},
enumerable:!0,configurable:!0});Service.prototype.setMaxUploadRetryTime=function(time){validate("setMaxUploadRetryTime",[nonNegativeNumberSpec()],arguments);this.authWrapper_.setMaxUploadRetryTime(time)};Object.defineProperty(Service.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:!0,configurable:!0});Service.prototype.setMaxOperationRetryTime=function(time){validate("setMaxOperationRetryTime",[nonNegativeNumberSpec()],arguments);this.authWrapper_.setMaxOperationRetryTime(time)};
Object.defineProperty(Service.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0});Object.defineProperty(Service.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0});return Service}(),ServiceInternals=function(){function ServiceInternals(service){this.service_=service}ServiceInternals.prototype.delete=function(){this.service_.authWrapper_.deleteApp();return Promise.resolve(void 0)};return ServiceInternals}();registerStorage(firebase);
exports.registerStorage=registerStorage}
//# sourceMappingURL=module$node_modules$$firebase$storage$dist$index_cjs.js.map
